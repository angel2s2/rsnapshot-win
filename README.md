# rsnapshot-win

На днях понадобилось организовать бэкапы с win на win, но места было мало. Бегло погуглил софт и варианты `rsnapshot`...

Нашел утилиту [ln.exe](https://schinagl.priv.at/nt/ln/ln.html) от [Hermann Schinagl](https://schinagl.priv.at/), у которой есть режим `DeLorean Copy`, который как раз реализует то, что нужно.
В архиве с `ln.exe` идут несколько cmd-скриптов. Я просто доработал под себя один из этих скриптов, чтобы было логгирование.

Проверял на win7 и win10.

# Настройка

В скрипте в 11 строке в переменной `LN` нужно указать путь до `ln.exe`.


# Как работает скрипт

```batch
Usage: DeLoreanCopy <SourcePath> <DestPath> (<KeepMaxCopies>)

 SourcePath    directory containing the files to be backed up
 DestPath      directory where "DeLorean copy" sets will be created
 KeepMaxCopies (opt.) remove any exceeding number of DLC sets before copying

e.g. DeLoreanCopy c:\data\source c:\data\backup 90
```



Если в каталоге `DestPath` пусто, то скрипт считает, что это первое копирование и просто копирует всю папку (первый полный бэкап) в созданную им папку вида `ГГГГ-ММ-ДД ЧЧ-ММ-СС`.

Если в каталоге `DestPath` есть папки, то скрипт считает, что это 2+ запуск. Возьмет самую свежую папку из предыдущих бэкапов и сделает жесткие ссылки на все файлы в новую папку вида `ГГГГ-ММ-ДД ЧЧ-ММ-CC`. Потом скопирует из источника все новые и измененные файлы и папки в новую папку вида `ГГГГ-ММ-ДД ЧЧ-ММ-СС`, заменяя имеющиеся там жесткие ссылки.

В процессе работы скрипт пишет лог в текущую папку бэкапа, т.е. `DestPath\ГГГГ-ММ-ДД ЧЧ-ММ-СС`. Файл `log_ГГГГ-ММ-ДД ЧЧ-ММ-СС.log`.

После бэкапа скрипт удаляет старые бэкапы, осталяя `KeepMaxCopies` последних бэкапов. Если `KeepMaxCopies` не указан, то старые бэкапы не удаляются.


# Права
В репозитории есть файлы `ln.exe` (64bit, static), `ln32static.zip` и `ln64static.zip`. Права на эти файлы и их содержимое принадлежат [Hermann Schinagl](https://schinagl.priv.at/), лицензия на эти файлы укана внутри архивов. Эти файлы сохранил в репозитории для удобства, чтобы не нужно было искать по разным сайтам.

Мною был доработан под свои нужды только файл `DeLoreanCopy.bat` из архива -- `rsnapshot-win.bat`. 


# P.S.

Скрипт выкладываю как есть. Используйте на свой страх и риск.

